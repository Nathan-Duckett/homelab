x-linuxserver-common: &linuxserver-common
  environment:
    PUID: 1000
    PGID: 1000
    TZ: Pacific/Auckland
  profiles:
    - media
  labels:
    - svc.stack=media
  restart: unless-stopped

services:
  # Sonarr installation
  sonarr:
    <<: *linuxserver-common
    image: linuxserver/sonarr:latest
    container_name: sonarr
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/sonarr/sonarr:/config
      - ${MEDIA_LOCATION}/tv:/tv
      - ${DOWNLOADS_LOCATION}:/downloads
    labels:
      - traefik.http.routers.sonarr.rule=Host(`sonarr.${URL}`)
      - traefik.http.services.sonarr.loadbalancer.server.port=8989
  # Radarr installation
  radarr:
    <<: *linuxserver-common
    image: linuxserver/radarr:develop
    container_name: radarr
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/radarr/radarr:/config
      - ${MEDIA_LOCATION}/movies:/movies
      - ${DOWNLOADS_LOCATION}:/downloads
    labels:
      - traefik.http.routers.radarr.rule=Host(`radarr.${INTERNAL_URL}`)
      - traefik.http.services.radarr.loadbalancer.server.port=7878
  # Lidarr installation
  lidarr:
    <<: *linuxserver-common
    image: linuxserver/lidarr
    container_name: lidarr
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/lidarr/lidarr:/config
      - ${MEDIA_LOCATION}/music:/music
      - ${DOWNLOADS_LOCATION}:/downloads
    labels:
      - traefik.http.routers.lidarr.rule=Host(`lidarr.${INTERNAL_URL}`)
      - traefik.http.services.lidarr.loadbalancer.server.port=8686
  bazarr:
    <<: *linuxserver-common
    image: linuxserver/bazarr
    container_name: bazarr
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/bazarr/bazarr:/config
      - ${MEDIA_LOCATION}/movies:/movies
      - ${MEDIA_LOCATION}/tv:/tv
    labels:
      - traefik.http.routers.bazarr.rule=Host(`bazarr.${INTERNAL_URL}`)
      - traefik.http.services.bazarr.loadbalancer.server.port=6767
    
  # huntarr:
  #   <<: *linuxserver-common
  #   image: huntarr/huntarr:latest
  #   container_name: huntarr
  #   volumes:
  #     - ${MEDIA_CONFIG_LOCATION}/huntarr:/config
  #   labels:
  #     - traefik.http.routers.huntarr.rule=Host(`huntarr.${INTERNAL_URL}`)
  #     - traefik.http.services.huntarr.loadbalancer.server.port=9705

  overseerr:
    <<: *linuxserver-common
    image: sctx/overseerr:latest
    container_name: overseerr
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/overseerr/overseerr:/app/config
    labels:
      - traefik.http.routers.overseerr.rule=Host(`overseerr.${URL}`)
      - traefik.http.services.overseerr.loadbalancer.server.port=5055

  # Jackett installation
  jackett:
    <<: *linuxserver-common
    image: linuxserver/jackett
    container_name: jackett
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/jackett/jackett:/config
      - ${DOWNLOADS_LOCATION}:/downloads
    labels:
      - traefik.http.routers.jackett.rule=Host(`jackett.${INTERNAL_URL}`)
      - traefik.http.services.jackett.loadbalancer.server.port=9117
  # Tautulli installation
  tautulli:
    <<: *linuxserver-common
    image: linuxserver/tautulli
    container_name: tautulli
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/tautulli/tautulli:/config
      - /var/lib/plexmediaserver/Library/Application Support/Plex Media Server/Logs:/logs
    labels:
      - traefik.http.routers.tautulli.rule=Host(`tautulli.${INTERNAL_URL}`)
      - traefik.http.services.tautulli.loadbalancer.server.port=8181
  # qBittorrent VPN installation
  qbittorrent:
    <<: *linuxserver-common
    image: "markusmcnugen/qbittorrentvpn"
    container_name: "qbittorrent"
    privileged: true
    environment:
      - "VPN_ENABLED=yes"
      - "LAN_NETWORK=192.168.50.0/24"
      - "NAME_SERVERS=1.1.1.1,8.8.8.8"
      - PUID=1000
      - PGID=1000
    ports:
      - 8999:8999
      - 8999:8999/udp
    labels:
      - traefik.http.routers.qbittorrent.rule=Host(`qbittorrent.${INTERNAL_URL}`)
      - traefik.http.services.qbittorrent.loadbalancer.server.port=8080
    volumes:
      - "${MEDIA_CONFIG_LOCATION}/qBittorrent/qBittorrent:/config:cached"
      - "${DOWNLOADS_LOCATION}:/downloads:cached"

  dizquetv:
    <<: *linuxserver-common
    container_name: dizquetv
    image: vexorian/dizquetv:latest
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/dizquetv:/home/node/app/.dizquetv
    restart: unless-stopped
    ports:
      - 30140:8000
    labels:
      - traefik.http.routers.dizquetv.rule=Host(`tv.${INTERNAL_URL}`)
      - traefik.http.services.dizquetv.loadbalancer.server.port=8000
      - svc.stack=media

  maintainerr:
    <<: *linuxserver-common
    image: ghcr.io/maintainerr/maintainerr:latest
    container_name: maintainerr
    user: 1000:1000
    volumes:
      - ${MEDIA_CONFIG_LOCATION}/maintainerr/maintainerr:/opt/data
    labels:
      - traefik.http.routers.maintainerr.rule=Host(`maintainerr.${INTERNAL_URL}`)
      - traefik.http.services.maintainerr.loadbalancer.server.port=6246
      - svc.stack=media

  plex:
    <<: *linuxserver-common
    container_name: plex
    image: plexinc/pms-docker:latest
    network_mode: host
    volumes:
      - ${DOCKER_SERVICES_CONFIG_LOCATION}/plex:/config
      - ${MEDIA_LOCATION}/tv:/data/tv:ro
      - ${MEDIA_LOCATION}/movies:/data/movies:ro
      - ${MEDIA_LOCATION}/music:/data/music:ro
      - ${MEDIA_LOCATION}/music_videos:/data/music_videos:ro
      - ${PICTURES_LOCATION}:/data/pictures:ro
    devices:
     - /dev/dri:/dev/dri